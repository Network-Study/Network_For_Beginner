# 8장 서버 네트워크 기본
## 8.1 서버의 네트워크 설정 및 확인
- 배경
  - 기본적인 네트워크 설정: IP 주소, 서브넷, 게이트웨이, DNS IP 주소
  - 서버뿐만 아니라 네트워크에 연결하려는 모든 장비(노트북, 데스크톱 등등)에 설정해주어야 함
  - 모두 수동으로 설정하는 것이 번거로워 자동으로 네트워크를 설정해주는 DHCP 기술을 주로 사용함

### 리눅스 서버 네트워크
- 일반적으로 리눅스에서는 설정 파일이 텍스트 형식이고, 이 텍스트를 직접 수정해 시스템 구성을 변경함
- 각 인터페이스 설정은 하나의 파일에서 모두 설정하는 것이 아니라 인터페이스별 설정 파일로 따로 관리함
- 인터페이스 설정 파일을 수정하더라도 변경값이 즉시 적용되지 않음. 네트워크 서비스를 재시작하거나 인터페이스를 재시작 해야함
  - centos 기준: systemctl restart network.service
  - ubuntu 기준: /etc/init.d/networking restart
- 현재 인터페이스 정보: ifconfig
  - IP 주소, 서브넷, 게이트웨이, MTU 크기, 송수신 패킷 수, 에러 패킷 등의 정보 볼 수 있음
 
## 8.2 서버의 라우팅 테이블
- 배경
  - 네트워크 장비와 마찬가지로 서버에서도 외부 네트워크와 통신하기 위해 라우팅 테이블을 가짐
  - 네트워크 정보를 설정할 때 IP, 서브넷 마스크, 기본 게이트웨이의 IP 주소를 입력하는데, 이때 디폴트 라우팅이 라우팅 테이블에 자동으로 등록됨
  - 디폴트 라우팅을 이용해 네트워크 기본 설정을 하면 내부, 외부 네트워크 모두 통신 가능
  - 두 개 이상의 네트워크를 연결해서 사용할 땐 고려가 필요함
    - 두 네트워크 어댑터에 모두 디폴트 게이트 웨이 설정을 하면 통신 안됨
    - 외부 공인망과 통신해야 하는 프론트쪽 네트워크 어댑터에만 디폴트 게이트웨이를 설정하고, 백엔드를 연결하는 어댑터에는 적절한 라우팅 정보를 설정해줘야 함
  - 하지만, 하이퍼바이저가 설치된 가상화 서버에서는 하나의 물리 서버 안에서 공인망 가상머신과 사설망 가상머신을 모두 운용해도 라우팅 테이블 설정을 따로 안해도 됨
    - 논리적으로 구분된 가상 서버안에서는 별도의 분리된 장비처럼 동작하기 때문
    - 하나의 가상 머신에 공인망 네트워크와 사설망 네트워크를 모두 할당쌔을 경우에는 조정이 필요함

### 서버의 라우팅 테이블
- 서버 라우팅 테이블 항목
  - 목적지
    - ex) 10.10.20.0
    - 서버가 통신하려는 목적지 IP 주소에 맞는 라우팅을 선택하는 기준이 됨
  - 서브넷
    - ex) 24
    - 서버가 통신하려는 목적지 IP 주소에 맞는 라우팅을 선택하는 기준이 됨
    - 서버가 통신하려는 목적지가 10.0.20.10이고 라우팅 테이블 목적지가 10.10.20.0, 서브넷이 24bit 면 해당 라우팅 테이블이 표현하는 목적지 범위는 10.10.20.0~10.10.20.255 이므로 
      통신하려는 목적지가 포함되어 라우팅을 적용함
  - 게이트웨이
    - ex) 10.10.10.1
    - 선택된 목적지로 가기 위해 서버에서 선택하는 넥스트 홉
    - 목적지가 로컬네트워크이면 '연결됨'이라고 표기되고 리모트 네트워크이면 해당 네트워크의 게이트웨이로 설정됨
  - 인터페이스
    - ex) eth1
    - 서버의 네트워크 카드를 뜻하고 어떤 물리적인 경로로 패킷을 내보낼지 결정함
  - 우선순위
    - ex) 10
    - 테이블이 두 개 이상 존재할 때 어떤 라우팅 테이블을 선택할지 정하는 값(낮을수록 우선순위 높음)

### 리눅스 서버의 라우팅 확인 및 관리
- ip route 명렁어 사용
- netstat -r 명령어 사용

### 윈도우 서버의 라우팅 확인 및 관리
- route 명령어 사용

## 8.3 네트워크 확인을 위한 명령어
- 네트워크 상태를 확인하는 데 필요한 명령어

### ping(Packet InterNet Groper)
- ping \[옵션\] 목적지IP주소
- IP 네트워크를 통해 특정 목적지까지 네트워크가 잘 동작하고 있는지 확인하는 명령어
- ICMP 인터넷 프로토콜을 사용함

### tcping
- 윈도우 용
- 서비스 포트가 열려있는지 확인하는 명령어

### traceroute(리눅스)/tracert(윈도우)
- 출발지부터 통신하거나 목적지까지의 네트워크 경로를 확인할 때 사용하는 명령어
- 출발지 pc에서 목적지까지의 라우팅 경로를 확인할 수 있고 목적지까지의 통신에 문제가 생겼을 때 어느 구간부터 문제가 발생했는지 찾아낼 수 있음
- 네트워크 응답 시간이 느린 경우 어느 구간에서 응답시간이 느려지는지도 확인 가능

### tcptraceroute
- 경로정보 뿐만 아니라 서비스 포트도 확인할 수 있는 명령어
- 출발지부터 최종 목적지까지 서비스 포트가 정상적으로 열리는지 확인할 수 있고 열리지 않는다면 어느 구간부터 막히는지 확인할 수 있음

### netstat(network statistics)
- 서버의 다양한 네트워크 상태를 확인하는데 사용
- 서비스 포트 상태를 확인하는 용도로 가장 많이 사용함
  - 현재 서버에서 특정 서비스가 정상적으로 열려있는지(LISTENING)
  - 외부 서비스와 TCP 세션이 정상적으로 맺어져 있는지(ESTABLISHED)
  - 서비스가 정상적으로 종료되고 있는지(TIME_WAIT, FIN_WAIT, CLOSE_WAIT) 
- 라우팅 테이블이나 인터페이스 패킷 오계정보 확인도 가능

### ss(socket statistics)
- 소켓 정보를 확인할 수 있는 네트워크 명령
- netstat 명령어를 대체하는 것 뿐만 아니라, 더 많은 정보를 추가로 제공

### nslookup(name server lookup)
- DNS에 다양한 도메인 관련 내용을 질의해 결괏값을 전송받을 수 있는 네트워크 명령
- 주로 특정 도메인에 매핑된 IP 주소를 확인하기 위해 사용

### telnet(tele network)
- 원격지 호스트에 터미널 연결을 위해 사용되는 매우 오래된 표준 프로토콜
- 서버에 접근해 관리하는 용도, 네트워크 문제 해결을 위해 특정 서버의 서비스에 대한 접근 가능성을 테스으하는 용도
- 평문을 사용하기 때문에 해커에 의해 통신 내용을 감청당할 수 있어 보안을 중시하는 최근 요구사항을 충족시키지 못함
- 최근에는 암호화된 ssh 사용이 권고됨

### ipconfig
- 네트워크 설정을 확인하는 윈도우 명령어
- DHCP 환경에서 할당받은 현재 IP 주소를 해제하고 갱신하는 옵션
- 현재 서버에서 도메인에 대한 로컬 캐시 정보를 지우기 위해 사용하는 옵션

### tcpdump
- 네트워크 인터페이스로 오가는 패킷을 캡처해보는 기능의 명령어
- 평소에는 사용하지 않지만 장애 처리나 패킷 분석이 필요할 때 자주 사용
- 주로 리눅스 서버에서 사용


